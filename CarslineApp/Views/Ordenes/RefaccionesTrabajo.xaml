<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CarslineApp.Views.Ordenes.RefaccionesTrabajo"
             xmlns:models="clr-namespace:CarslineApp.Models"
             xmlns:viewmodel="clr-namespace:CarslineApp.ViewModels"
             x:DataType="viewmodel:RefaccionesTrabajoViewModel"
             Title="Refacciones del Trabajo"
             x:Name="Page"
             BackgroundColor="#F5F5F5">
    <ScrollView>
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" Padding="15">

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- SECCIÃ“N 1: Info del Trabajo                -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Frame Grid.Row="0"
                   BackgroundColor="White"
                   CornerRadius="12"
                   Padding="0"
                   BorderColor="#800020"
                   Margin="0,0,0,10"
                   HasShadow="True">
                <VerticalStackLayout Spacing="0" Padding="4">
                    <Grid BackgroundColor="White"
                          Padding="15,12"
                          ColumnDefinitions="Auto,*">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleInfoCommand}"/>
                        </Grid.GestureRecognizers>
                        <Label Grid.Column="0" Text="{Binding IconoInfo}"
                               FontSize="16" FontAttributes="Bold" TextColor="#800020"
                               VerticalOptions="Center" Margin="0,0,10,0"/>
                        <Label Grid.Column="1" Text="ðŸ“‹ InformaciÃ³n del Trabajo"
                               FontSize="15" FontAttributes="Bold" TextColor="#800020"
                               VerticalOptions="Center"/>
                    </Grid>

                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="*,*,*" ColumnSpacing="5"
                          IsVisible="{Binding InfoTrabajoVisible}">
                        <Label Grid.Column="0" Grid.Row="0" Text="Trabajo:" FontSize="14"
                               FontAttributes="Bold" TextColor="#555" VerticalOptions="Center"/>
                        <Label Grid.Column="1" Grid.Row="0" Text="{Binding NombreTrabajo}"
                               FontSize="17" FontAttributes="Bold" TextColor="#333"
                               LineBreakMode="WordWrap" VerticalOptions="Center"/>
                        <Label Grid.Column="0" Grid.Row="1" Text="VehÃ­culo:" FontSize="14"
                               FontAttributes="Bold" TextColor="#555" VerticalOptions="Start"/>
                        <Label Grid.Column="1" Grid.Row="1" Text="{Binding VehiculoCompleto}"
                               FontSize="14" TextColor="#333" LineBreakMode="WordWrap"
                               VerticalOptions="Start"/>
                        <Label Grid.Column="0" Grid.Row="2" Text="VIN:" FontSize="14"
                               FontAttributes="Bold" TextColor="#555" VerticalOptions="Start"/>
                        <Label Grid.Column="1" Grid.Row="2" Text="{Binding VIN}"
                               FontSize="14" TextColor="#333" FontFamily="Courier"
                               VerticalOptions="Start"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- SECCIÃ“N 2: Mano de Obra                    -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Frame Grid.Row="1"
                   BackgroundColor="White"
                   CornerRadius="12"
                   Padding="0"
                   Margin="0,0,0,10"
                   HasShadow="True">
                <VerticalStackLayout Spacing="0">
                    <Grid BackgroundColor="#800020" Padding="15,12" ColumnDefinitions="Auto,*">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleManoObraCommand}"/>
                        </Grid.GestureRecognizers>
                        <Label Grid.Column="0" Text="{Binding IconoManoObra}"
                               FontSize="16" FontAttributes="Bold" TextColor="White"
                               VerticalOptions="Center" Margin="0,0,10,0"/>
                        <Label Grid.Column="1" Text="ðŸ”§ Mano de Obra"
                               FontSize="15" FontAttributes="Bold" TextColor="White"
                               VerticalOptions="Center"/>
                    </Grid>

                    <VerticalStackLayout Spacing="12" Padding="15"
                                         IsVisible="{Binding ManoObraExpandido}">

                        <Label Text="Ingresar manualmente" FontSize="13" TextColor="#666"
                               FontAttributes="Bold"/>
                        <Grid ColumnDefinitions="150,140" ColumnSpacing="10">
                            <Frame Grid.Column="0" BorderColor="#800020" CornerRadius="8"
                                   Padding="0" BackgroundColor="Transparent" HasShadow="False">
                                <Entry Placeholder="$0.00"
                                       Text="{Binding PrecioManoObraTexto}"
                                       Keyboard="Numeric" BackgroundColor="White"
                                       PlaceholderColor="#999" TextColor="#333"
                                       ReturnCommand="{Binding EditarManoObraCommand}"
                                       HeightRequest="45" Margin="10,0"/>
                            </Frame>
                            <Button Grid.Column="1" Text="Guardar"
                                    Command="{Binding EditarManoObraCommand}"
                                    BackgroundColor="#800020" TextColor="White"
                                    CornerRadius="8" HeightRequest="45"
                                    VerticalOptions="End" FontSize="13" FontAttributes="Bold"/>
                        </Grid>

                        <!-- Separador -->
                        <BoxView HeightRequest="1" Color="#E8E8E8" Margin="0,4"/>

                        <!--Calcular automÃ¡ticamente-->
                        <Label Text="ðŸ“Š Cuadrar mano de obra "
                               FontSize="13" TextColor="#666" FontAttributes="Bold"/>
                        <Label Text="Ingresa el costo total que cobrarÃ¡ al cliente."
                               FontSize="12" TextColor="#888" LineBreakMode="WordWrap"/>

                        <Grid ColumnDefinitions="150,140" ColumnSpacing="10">
                            <Frame Grid.Column="0" BorderColor="#555" CornerRadius="8"
                                   Padding="0" BackgroundColor="Transparent" HasShadow="False">
                                <Entry Placeholder="Total ($)"
                                       Text="{Binding CostoTotalTrabajoTexto}"
                                       Keyboard="Numeric" BackgroundColor="White"
                                       PlaceholderColor="#999" TextColor="#333"
                                       HeightRequest="45" Margin="10,0"
                                       ReturnCommand="{Binding CalcularManoObraCommand}"/>
                            </Frame>
                            <Button Grid.Column="1" Text="Calcular"
                                    Command="{Binding CalcularManoObraCommand}"
                                    BackgroundColor="#555" TextColor="White"
                                    CornerRadius="8" HeightRequest="45"
                                    VerticalOptions="End" FontSize="13" FontAttributes="Bold"/>
                        </Grid>

                        <!-- Resultado del cÃ¡lculo -->
                        <Frame IsVisible="{Binding HayManoObraCalculada}"
                               BackgroundColor="#F0FFF4" BorderColor="#2E7D32"
                               CornerRadius="8" Padding="12" HasShadow="False">
                            <Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto,Auto" ColumnSpacing="6">
                                
                                <Label Grid.Column="0" Grid.Row="0"
                                       Text="Calculo:"
                                       HorizontalOptions="Start"
                                       VerticalOptions="Center"
                                       FontSize="13" TextColor="Black" FontAttributes="Bold"/>
                                <Label Grid.Column="1" Grid.Row="0"
                                       VerticalOptions="Center"
                                       Text="{Binding ManoObraCalculadaFormateada}"
                                       FontSize="16" TextColor="#2E7D32" FontAttributes="Bold"
                                       HorizontalTextAlignment="End"/>

                                <Button Grid.Column="2" Grid.Row="0"
                                        Text="âœ… Aplicar "
                                        Command="{Binding AplicarManoObraCalculadaCommand}"
                                        BackgroundColor="#2E7D32" TextColor="White"
                                        CornerRadius="8" HeightRequest="40"
                                        WidthRequest="150"
                                        HorizontalOptions="End"
                                        FontSize="13" FontAttributes="Bold"
                                        Margin="0,0,0,0"/>
                            </Grid>
                        </Frame>

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- SECCIÃ“N 3: Refacciones Predeterminadas         -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Frame Grid.Row="2"
                   BackgroundColor="White"
                   CornerRadius="12"
                   Padding="0"
                   Margin="0,0,0,10"
                   HasShadow="True"
                   IsVisible="{Binding HayRefaccionesPredeterminadas}">
                <VerticalStackLayout Spacing="0">
                    <!-- Encabezado -->
                    <Grid BackgroundColor="#5C4033" Padding="15,12" ColumnDefinitions="Auto,*">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding TogglePredeterminadasCommand}"/>
                        </Grid.GestureRecognizers>
                        <Label Grid.Column="0" Text="{Binding IconoPredeterminadas}"
                               FontSize="16" FontAttributes="Bold" TextColor="White"
                               VerticalOptions="Center" Margin="0,0,10,0"/>
                        <Label Grid.Column="1" Text="âš¡Refacciones Sugeridas "
                               FontSize="15" FontAttributes="Bold" TextColor="White"
                               VerticalOptions="Center"/>
                    </Grid>

                    <!-- Lista de predeterminadas -->
                    <VerticalStackLayout Spacing="0" Padding="0"
                                         IsVisible="{Binding PredeterminadasExpandido}">

                        <!-- Encabezado columnas -->
                        <Grid ColumnDefinitions="3*,1.2*,2*,1.5*" ColumnSpacing="8"
                              BackgroundColor="#F5EFE6" Padding="12,8">
                            <Label Grid.Column="0" Text="RefacciÃ³n" FontSize="12"
                                   FontAttributes="Bold" TextColor="#5C4033"/>
                            <Label Grid.Column="1" Text="Cant." FontSize="12"
                                   FontAttributes="Bold" TextColor="#5C4033"
                                   HorizontalTextAlignment="Center"/>
                            <Label Grid.Column="2" Text="Precio Unit." FontSize="12"
                                   FontAttributes="Bold" TextColor="#5C4033"
                                   HorizontalTextAlignment="Center"/>
                            <Label Grid.Column="3" Text="" FontSize="12" TextColor="#5C4033"/>
                        </Grid>

                        <CollectionView ItemsSource="{Binding RefaccionesPredeterminadas}"
                                        SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:RefaccionPredeterminadaViewModel">
                                    <Grid ColumnDefinitions="3*,1.6*,2*,1.5*"
                                          ColumnSpacing="8" Padding="12,10"
                                          BackgroundColor="White">

                                        <!-- LÃ­nea separadora inferior -->
                                        <BoxView Grid.ColumnSpan="4" HeightRequest="1"
                                                 Color="#F0F0F0" VerticalOptions="End"/>

                                        <!-- Nombre -->
                                        <Label Grid.Column="0" Text="{Binding Nombre}"
                                               FontSize="13" TextColor="#333"
                                               LineBreakMode="WordWrap"
                                               VerticalOptions="Center"/>

                                        <!-- Cantidad FIJA: solo muestra el valor -->
                                        <Label Grid.Column="1"
                                               Text="{Binding CantidadLabelTexto}"
                                               FontSize="13" TextColor="#5C4033"
                                               FontAttributes="Bold"
                                               HorizontalTextAlignment="Center"
                                               VerticalOptions="Center"
                                               IsVisible="{Binding CantidadFija}"/>

                                        <!-- Cantidad VARIABLE: campo editable -->
                                        <Frame Grid.Column="1"
                                               BorderColor="#5C4033"
                                               CornerRadius="6" Padding="0"
                                               BackgroundColor="Transparent" HasShadow="False"
                                               VerticalOptions="Center"
                                               IsVisible="{Binding CantidadVariable}">
                                            <Entry Placeholder="Cant."
                                                   Text="{Binding CantidadTextoEditable}"
                                                   Keyboard="Numeric"
                                                   BackgroundColor="White"
                                                   PlaceholderColor="#AAA"
                                                   TextColor="#333"
                                                   FontSize="13"
                                                   HeightRequest="36"
                                                   Margin="4,0"/>
                                        </Frame>

                                        <!-- Precio (siempre editable) -->
                                        <Frame Grid.Column="2" BorderColor="#5C4033"
                                               CornerRadius="6" Padding="0"
                                               BackgroundColor="Transparent" HasShadow="False"
                                               VerticalOptions="Center">
                                            <Entry Placeholder="$0.00"
                                                   Text="{Binding PrecioTexto}"
                                                   Keyboard="Numeric"
                                                   BackgroundColor="White"
                                                   PlaceholderColor="#AAA"
                                                   TextColor="#333"
                                                   FontSize="13"
                                                   HeightRequest="36"
                                                   Margin="6,0"/>
                                        </Frame>

                                        <!-- BotÃ³n Agregar -->
                                        <Button Grid.Column="3"
                                                Text="+"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:RefaccionesTrabajoViewModel}}, Path=AgregarPredeterminadaCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#5C4033"
                                                TextColor="White"
                                                CornerRadius="6"
                                                FontSize="18"
                                                FontAttributes="Bold"
                                                HeightRequest="40"
                                                WidthRequest="40"
                                                HorizontalOptions="Center"
                                                VerticalOptions="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <Label Text="ðŸ’¡ Ingresa el precio y pulsa + para agregar a la lista"
                               FontSize="11" TextColor="#888"
                               HorizontalTextAlignment="Center"
                               Margin="0,8,0,12"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- SECCIÃ“N 4: Agregar RefacciÃ³n Manual        -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Frame Grid.Row="3"
                   BackgroundColor="White"
                   CornerRadius="12"
                   Padding="0"
                   Margin="0,0,0,10"
                   HasShadow="True">
                <VerticalStackLayout Spacing="0">
                    <Grid BackgroundColor="#800020" Padding="15,12" ColumnDefinitions="Auto,*">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleFormularioCommand}"/>
                        </Grid.GestureRecognizers>
                        <Label Grid.Column="0" Text="{Binding IconoFormulario}"
                               FontSize="16" FontAttributes="Bold" TextColor="White"
                               VerticalOptions="Center" Margin="0,0,10,0"/>
                        <Label Grid.Column="1" Text=" Agregar RefacciÃ³n Personalizada"
                               FontSize="15" FontAttributes="Bold" TextColor="White"
                               VerticalOptions="Center"/>
                    </Grid>

                    <VerticalStackLayout Spacing="5" Padding="15"
                                         IsVisible="{Binding FormularioExpandido}">
                        <!-- Nombre -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="RefacciÃ³n" FontSize="14" TextColor="#666" FontAttributes="Bold"/>
                            <Frame BorderColor="#800020" BackgroundColor="Transparent"
                                   CornerRadius="8" Padding="0" HasShadow="False">
                                <Entry Placeholder="Nombre de la refacciÃ³n"
                                       Text="{Binding NuevaRefaccion}"
                                       BackgroundColor="White" PlaceholderColor="#999"
                                       TextColor="#333" HeightRequest="40" Margin="10,0"/>
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Cantidad y Precio -->
                        <Grid ColumnDefinitions="Auto,Auto,150" ColumnSpacing="10">
                            <VerticalStackLayout Grid.Column="0" Spacing="5">
                                <Label Text="Cantidad" FontSize="14" TextColor="#666" FontAttributes="Bold"/>
                                <Frame BorderColor="#800020" BackgroundColor="Transparent"
                                       CornerRadius="8" Padding="0" HasShadow="False">
                                    <Entry Placeholder="0" Text="{Binding NuevaCantidad}"
                                           Keyboard="Numeric" BackgroundColor="White"
                                           MaxLength="3" PlaceholderColor="#999"
                                           TextColor="#333" HeightRequest="40" Margin="10,0"/>
                                </Frame>
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="5">
                                <Label Text="Precio Unitario" FontSize="13" TextColor="#666" FontAttributes="Bold"/>
                                <Frame BorderColor="#800020" BackgroundColor="Transparent"
                                       CornerRadius="8" Padding="0" HasShadow="False">
                                    <Entry Placeholder="$0.00" Text="{Binding NuevoPrecioUnitario}"
                                           Keyboard="Numeric" BackgroundColor="White"
                                           PlaceholderColor="#999" TextColor="#333"
                                           HeightRequest="40"
                                           ReturnCommand="{Binding AgregarRefaccionCommand}"
                                           Margin="10,0"/>
                                </Frame>
                            </VerticalStackLayout>

                            <Button Grid.Column="2" Text="Agregar "
                                    Command="{Binding AgregarRefaccionCommand}"
                                    BackgroundColor="#800020" TextColor="White"
                                    CornerRadius="8" HeightRequest="48"
                                    FontAttributes="Bold" FontSize="14"
                                    VerticalOptions="End" Margin="0,5,0,0"/>
                        </Grid>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Encabezado tabla de refacciones            -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Frame Grid.Row="4" BackgroundColor="#800020" CornerRadius="8"
                   Padding="12,10" HasShadow="False" Margin="0,0,0,0">
                <Grid ColumnDefinitions="3*,1.8*,2*,2*,1*" ColumnSpacing="5">
                    <Label Grid.Column="0" Text="RefacciÃ³n" FontSize="13"
                           FontAttributes="Bold" TextColor="White"/>
                    <Label Grid.Column="1" Text="Cantidad" FontSize="13"
                           FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Grid.Column="2" Text="Precio Unit." FontSize="13"
                           FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="End"/>
                    <Label Grid.Column="3" Text="Subtotal" FontSize="13"
                           FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="End"/>
                    <Label Grid.Column="4" Text="" FontSize="13" TextColor="White"/>
                </Grid>
            </Frame>

            <BoxView Grid.Row="5" HeightRequest="1" Color="#E0E0E0" Margin="0"/>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Lista de refacciones                       -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <ScrollView Grid.Row="6">
                <VerticalStackLayout Spacing="0">
                    <Frame BackgroundColor="White" CornerRadius="8"
                           Padding="0" HasShadow="True" Margin="0">
                        <CollectionView ItemsSource="{Binding Refacciones}" SelectionMode="None">
                            <CollectionView.EmptyView>
                                <DataTemplate>
                                    <StackLayout Padding="20" HorizontalOptions="Center"
                                                 VerticalOptions="Center">
                                        <Label Text="ðŸ“‹ No hay refacciones cargadas"
                                               TextColor="Black" FontSize="16"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="models:RefaccionTrabajoViewModel">
                                    <SwipeView>
                                        <SwipeView.RightItems>
                                            <SwipeItems Mode="Execute">
                                                <SwipeItem Text="Eliminar"
                                                           BackgroundColor="#C41E3A"
                                                           Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:RefaccionesTrabajoViewModel}}, Path=EliminarRefaccionCommand}"
                                                           CommandParameter="{Binding .}"/>
                                            </SwipeItems>
                                        </SwipeView.RightItems>

                                        <Grid ColumnDefinitions="3*,1.5*,2*,2*,1*"
                                              ColumnSpacing="5" Padding="12,15"
                                              BackgroundColor="White">
                                            <BoxView Grid.ColumnSpan="5" HeightRequest="1"
                                                     Color="#F0F0F0" VerticalOptions="End"/>

                                            <Label Grid.Column="0" Text="{Binding Nombre}"
                                                   FontSize="14" TextColor="#333"
                                                   LineBreakMode="WordWrap"
                                                   VerticalOptions="Center"/>
                                            <Label Grid.Column="1" Text="{Binding CantidadTexto}"
                                                   FontSize="14" TextColor="#555"
                                                   HorizontalTextAlignment="Center"
                                                   VerticalOptions="Center"/>
                                            <Label Grid.Column="2" Text="{Binding PrecioFormateado}"
                                                   FontSize="14" TextColor="#555"
                                                   HorizontalTextAlignment="End"
                                                   VerticalOptions="Center"/>
                                            <Label Grid.Column="3" Text="{Binding TotalFormateado}"
                                                   FontSize="14" FontAttributes="Bold"
                                                   TextColor="#800020"
                                                   HorizontalTextAlignment="End"
                                                   VerticalOptions="Center"/>
                                            <ImageButton Grid.Column="4"
                                                         BackgroundColor="Transparent"
                                                         Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:RefaccionesTrabajoViewModel}}, Path=EliminarRefaccionCommand}"
                                                         CommandParameter="{Binding .}"
                                                         Source="borrar.png"
                                                         WidthRequest="32" HeightRequest="32"
                                                         VerticalOptions="Center"
                                                         HorizontalOptions="Center"/>
                                        </Grid>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Frame>
                </VerticalStackLayout>
            </ScrollView>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Resumen de Totales                         -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Frame Grid.Row="7" BackgroundColor="White" CornerRadius="12"
                   Padding="20,15" Margin="0,15,0,0" HasShadow="True"
                   BorderColor="#800020">
                <VerticalStackLayout Spacing="5">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0" Text="Subtotal Refacciones:"
                               FontSize="13" TextColor="#666" VerticalOptions="Center"/>
                        <Label Grid.Column="1" Text="{Binding TotalRefaccionesFormateado}"
                               FontSize="13" TextColor="#333" FontAttributes="Bold"
                               VerticalOptions="Center"/>
                    </Grid>
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0" Text="Mano de Obra:"
                               FontSize="13" TextColor="#666" VerticalOptions="Center"/>
                        <Label Grid.Column="1" Text="{Binding ManoObraFormateado}"
                               FontSize="13" TextColor="#333" FontAttributes="Bold"
                               VerticalOptions="Center"/>
                    </Grid>
                    <BoxView HeightRequest="1" Color="#E0E0E0" Margin="0,5"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0" Text="Subtotal:"
                               FontSize="14" FontAttributes="Bold" TextColor="#333"
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1" Text="{Binding SubtotalFormateado}"
                               FontSize="14" FontAttributes="Bold" TextColor="#333"
                               VerticalOptions="Center"/>
                    </Grid>
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0" Text="IVA (16%):"
                               FontSize="13" TextColor="#666" VerticalOptions="Center"/>
                        <Label Grid.Column="1" Text="{Binding IvaFormateado}"
                               FontSize="13" TextColor="#333" FontAttributes="Bold"
                               VerticalOptions="Center"/>
                    </Grid>
                    <BoxView HeightRequest="2" Color="#800020" Margin="0,0"/>
                    <Grid ColumnDefinitions="*,Auto" Margin="0,5,0,0">
                        <Label Grid.Column="0" Text="TOTAL GENERAL:"
                               FontSize="15" FontAttributes="Bold" TextColor="#800020"
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1" Text="{Binding TotalGeneralFormateado}"
                               FontSize="17" FontAttributes="Bold" TextColor="#800020"
                               VerticalOptions="Center"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Indicador de carga -->
            <ActivityIndicator Grid.RowSpan="8"
                               IsRunning="{Binding EstaCargando}"
                               IsVisible="{Binding EstaCargando}"
                               Color="#800020"
                               WidthRequest="50" HeightRequest="50"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
        </Grid>
    </ScrollView>
</ContentPage>
